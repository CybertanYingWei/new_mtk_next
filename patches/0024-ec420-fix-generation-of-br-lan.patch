From 083b8e7b16469b52e125f7d0c3ef2ae1cf20291a Mon Sep 17 00:00:00 2001
From: John Crispin <john@phrozen.org>
Date: Thu, 17 Sep 2020 08:12:23 +0200
Subject: [PATCH 24/30] ec420: fix generation of br-lan

OpenWrt does not allow bridges with no default interfaces.

Fixes: WIFI-756
Signed-off-by: John Crispin <john@phrozen.org>
---
 package/base-files/files/bin/config_generate           | 2 +-
 target/linux/ipq40xx/base-files/etc/board.d/02_network | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/package/base-files/files/bin/config_generate b/package/base-files/files/bin/config_generate
index e94b1686ce..1dd7495b5e 100755
--- a/package/base-files/files/bin/config_generate
+++ b/package/base-files/files/bin/config_generate
@@ -70,7 +70,7 @@ generate_network() {
 		json_select ..
 	json_select ..
 
-	[ -n "$ifname" ] || return
+#	[ -n "$ifname" ] || return
 
 	# force bridge for multi-interface devices (and lan)
 	case "$1:$ifname" in
diff --git a/target/linux/ipq40xx/base-files/etc/board.d/02_network b/target/linux/ipq40xx/base-files/etc/board.d/02_network
index 888e509baa..56de6e61c3 100755
--- a/target/linux/ipq40xx/base-files/etc/board.d/02_network
+++ b/target/linux/ipq40xx/base-files/etc/board.d/02_network
@@ -52,6 +52,7 @@ ipq40xx_setup_interfaces()
 		;;
 	tp-link,ec420-g1)
 		ucidef_set_interface_wan "eth0"
+		ucidef_set_interface_lan ""
 		;;
 	avm,fritzrepeater-3000|\
 	compex,wpj428)
-- 
2.25.1

